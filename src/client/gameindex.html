<!DOCTYPE html>
<html>

<head>
  <title>Tasty Tails</title>
  <link rel="stylesheet" type="text/css" href="/css/normalize.css" />
  <link rel="stylesheet" type="text/css" href="/css/index.css" />

  <meta charset="UTF-8">
  <title>Chatting with people you can see</title>
  <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" -->
  <!-- integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"> -->
  <style>

    #chat-container {
        position:absolute;
        right:1%;
        top:45.9%;
        bottom:1%;
        left:50.25%;
      }

      form {
        position: absolute;
        top: 83.5%;
        bottom:0%;
        width: 100%;
      }

      .input-group {
        position: absolute;
        width: 100%;
        height: 100%;
        padding-left:.5%;
      }

      #m {
        position: absolute;
        width: 93.5%;
        height: 100%;
      }

      #btn {
        position: relative;
        left: 94.9%;
        bottom:-35%;
      }

      #messages {
        list-style-type: none;
        position: absolute;
        margin: auto;
        width: 100%;
        height:83%;
        padding: 0;
        border: 1px solid;
        padding-right: 1%;
        padding-left:.5%;
        padding-top:.5%;
        overflow-x: hidden;
        overflow-y:scroll;
      }

      #messages li {
        padding: 5px 10px;
        overflow-y: visible;
      }

      #messages li:nth-child(even){
        color: white;
        background: gray;
      }
    </style>
</head>

<body>

  <div id="phaserApp" tabindex="0">
  </div>

  <div id="chat-container">
    <div class="container-fluid">
      <div class="row">
        <ul id="messages"></ul>
      </div>
      <div class="row">
        <div class="col-xs-12">
          <form id="message-form" action="">
            <div class="input-group">
              <textarea id="m" autocomplete="off" class="form-control" placeholder="message" aria-label="message"></textarea>
              <span class="input-group.btn">
                <button id="btn" onclick="javascript:alert('just press the enter key for now...button doesn't work')">Send!</button>
              </span>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>



  <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="/js/index.js" type="module"></script>

  <script>
    var socket = io();
  </script>

  <script>
  var input = document.getElementById("m");
  input.addEventListener("keyup", function(event) {
    event.preventDefault();
    if (event.keyCode === 13) {
        form.onsubmit
    }
  });
</script>


  <script>

    const room = 'localchat';
    let chatFocused = true;

    const form = document.querySelector("form");
    const chat = document.querySelector("#m");
    const messages = document.querySelector("#messages");
    chat.addEventListener("keyup", function (event) {
      if (event.shiftKey) return;
      else if (event.keyCode === 13) {
        event.preventDefault();
        msg = chat.value;
        socket.emit('message', { msg, room });
        chat.value = "";
      }
    });

    socket.on('connect', () => {
      socket.emit('join', { room: room });
    });

    socket.on('message', (msg) => {
      const isScrolledToBottom = messages.scrollHeight - messages.clientHeight <= messages.scrollTop + 1;
      let li = document.createElement("li");
      li.innerHTML = msg;
      messages.appendChild(li);
      if (isScrolledToBottom) {
        messages.scrollTop = messages.scrollHeight - messages.clientHeight;
      }
    })
  </script>

  <script>
    setInterval("myFunction()", 1);

    function myFunction() {
      let phaserApp = document.getElementById("phaserApp");
      phaserApp.onfocus = function () {
        chatFocused = false;
        //console.log('ChatFocused = ', chatFocused);
      }
      phaserApp.onblur = function () {
        //when you stop focusingon it
        chatFocused = true;
        //console.log('ChatFocused = ', chatFocused);
      }
    }
  </script>

</body>

</html>
